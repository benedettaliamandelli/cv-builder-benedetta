<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CV Studio ‚Äî Editor</title>

<link rel="stylesheet" href="./styles.css"/>
<link rel="stylesheet" href="./fonts/fonts.css"/>

<style>
  :root {
    --accent:#2563eb;
    --rule:#e5e7eb;
    --sheet-w:210mm;
    --sheet-h:297mm;
    --toolbar-h:56px;
    --sidebar-w:360px;
    --bg:#f7f7fb;
  }
  *{box-sizing:border-box;}
  body {
    margin:0;
    background:var(--bg);
    color:#111827;
    font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
  }
  #toolbar {
    position:fixed;top:0;left:0;right:0;z-index:50;
    display:flex;align-items:center;gap:8px;
    padding:10px 14px;background:#fffffff2;
    backdrop-filter:saturate(120%) blur(6px);
    border-bottom:1px solid var(--rule);
  }
  .btn{border:1px solid var(--rule);background:white;border-radius:8px;padding:6px 10px;font-size:14px;cursor:pointer;}
  .btn:hover{background:#f3f4f6;}
  .btn-primary{background:var(--accent);border-color:var(--accent);color:white;}
  .btn-primary:hover{filter:brightness(.95);}
  .btn-danger{background:#fee2e2;border-color:#fecaca;color:#991b1b;}
  .field{border:1px solid var(--rule);border-radius:8px;padding:6px 8px;font-size:14px;}

  .wrap {
    display:grid;
    grid-template-columns: var(--sidebar-w) 1fr;
    height:calc(100vh - var(--toolbar-h));
    margin-top:var(--toolbar-h);
  }
  aside {
    border-right:1px solid var(--rule);
    background:#fff;
    overflow:auto;
    padding:14px;
  }
  .preview {
    overflow:auto;
    padding:24px;
    display:flex;
    justify-content:center;
    align-items:flex-start;
  }

  .sheets {
    display:flex;
    flex-direction:column;
    gap:24px;
    align-items:center;
    width:100%;
  }
  .sheet {
    width:var(--sheet-w);
    min-height:var(--sheet-h);
    background:white;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    padding:18mm 16mm;
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .sect-title {
    text-transform:uppercase;
    letter-spacing:.08em;
    font-size:11px;
    font-weight:600;
    color:var(--accent);
    border-bottom:1px solid var(--rule);
    padding-bottom:3px;
    margin-bottom:6px;
  }
  .editable[contenteditable="true"]{outline:0;}
  .editable[contenteditable="true"]:focus{box-shadow:inset 0 0 0 2px rgba(37,99,235,.25);border-radius:4px;}

  @media print{
    #toolbar,aside{display:none!important;}
    body{background:white!important;}
    .preview{padding:0!important;}
    .sheet{box-shadow:none!important;break-after:page;}
    @page{size:A4;margin:14mm;}
  }
</style>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Storage fallback -->
<script src="./storage.local.js"></script>
</head>
<body>
  <div id="toolbar">
    <a class="btn" href="./home.html">‚Üê Home</a>
    <button class="btn" id="addPageBtn">+ Page</button>
    <button class="btn" id="saveBtn">üíæ Save</button>
    <button class="btn-primary" id="printBtn">‚¨áÔ∏è Export PDF</button>
    <span style="margin-left:auto;font-weight:600">CV Studio Editor</span>
  </div>

  <div class="wrap">
    <aside>
      <div style="font-weight:600;margin-bottom:8px">Layout & Sections</div>
      <div id="sidebar"></div>
    </aside>
    <div class="preview">
      <div class="sheets" id="sheets"></div>
    </div>
  </div>

<script type="text/babel">
const { useState, useEffect } = React;
const rid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

const SAFE_DOC = {
  header:{name:"JOHN DOE",role:"Data Scientist",summary:"AI-focused engineer."},
  _layout:[{id:rid(),page:1,rows:[{id:rid(),type:"single",left:["headerSummary"],right:[]}]}],
};

function App(){
  const [doc,setDoc]=useState(SAFE_DOC);

  const CE = ({value,onChange,className="",style={}})=>(
    <div
      className={`editable ${className}`}
      style={style}
      contentEditable
      suppressContentEditableWarning
      onBlur={(e)=>onChange(e.currentTarget.textContent)}>
      {value}
    </div>
  );

  function save(){localStorage.setItem("cvdoc:Default",JSON.stringify(doc));alert("Saved!");}
  function print(){window.print();}
  function addPage(){
    setDoc(prev=>{
      const d=JSON.parse(JSON.stringify(prev));
      d._layout.push({id:rid(),page:d._layout.length+1,rows:[{id:rid(),type:"single",left:["headerSummary"],right:[]} ]});
      return d;
    });
  }

  useEffect(()=>{
    document.getElementById("saveBtn").onclick=save;
    document.getElementById("printBtn").onclick=print;
    document.getElementById("addPageBtn").onclick=addPage;
  },[doc]);

  const Header = () => (
    <div style={{borderBottom:"1px solid var(--rule)",paddingBottom:"8px"}}>
      <CE value={doc.header.name} onChange={(v)=>setDoc(p=>({...p,header:{...p.header,name:v}}))}
          style={{fontSize:"22pt",fontWeight:700,color:"var(--accent)"}}/>
      <CE value={doc.header.role} onChange={(v)=>setDoc(p=>({...p,header:{...p.header,role:v}}))}
          style={{fontSize:"12pt",fontWeight:500,color:"#374151"}}/>
      <CE value={doc.header.summary} onChange={(v)=>setDoc(p=>({...p,header:{...p.header,summary:v}}))}
          style={{marginTop:"6px",fontSize:"10pt",color:"#111"}}/>
    </div>
  );

  return (
    <>
      <div className="sheets">
        {doc._layout.map(pg=>(
          <div className="sheet" key={pg.id}>
            <Header/>
            <div className="sect-title" contentEditable suppressContentEditableWarning>Experience</div>
            <p contentEditable suppressContentEditableWarning style={{fontSize:"10pt",lineHeight:1.45}}>Add your experience here...</p>
          </div>
        ))}
      </div>
    </>
  );
}

ReactDOM.createRoot(document.getElementById("sheets")).render(<App/>);
</script>
</body>
</html>